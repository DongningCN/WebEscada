var g_ScriptDebug=true;var g_WldSvg=g_WldSvg||[];var g_WldWsServer="ws://47.106.93.198:37777";var g_WldGraphID=[],g_WldChartID=[];onload=Load;function Load(){var a=document.getElementById("SvgDom");eGraph_Dynamicload(a)}function DefConstant(){var a={SCRIPT_VERSION:"V2.01.01",LASTMODIFY_DATE:"2017-05-26 09:00:00",SOCKET_GROUP_NUM:48,XHR_HISDATA_TIME:12*300*1000,CURVEDB_FLUSHTIME:500,CHECKSTATU_TIME:10000};this.getConstants=function(b){return a[b]}}var MyConstant=new DefConstant();function eGraph_Dynamicload(e){console.log("脚本最后修改日期："+MyConstant.getConstants("LASTMODIFY_DATE"));if(e&&(e.nodeName=="svg")){console.log("加载evg文件ID："+e.id);if(g_WldSvg.length<1){g_WldWsServer=(typeof(GLOBAL_USER_PROFILE)!="undefined")?("ws:"+GLOBAL_USER_PROFILE.wss.rtdata[0]+":"+GLOBAL_USER_PROFILE.wss.WS_RTDB):g_WldWsServer;document.body.appendChild(iframe);g_WldSvg.push(CreateSvg(e));return}for(var d=0;d<g_WldSvg.length;d++){if(e.parentNode.id==g_WldSvg[d].ParentId){var g=g_WldSvg[d].IdStr;if(g){TraverseNodes(e,g)}g_WldSvg[d].Destroy();g_WldSvg[d]=CreateSvg(e,g);break}}if(d>=g_WldSvg.length){g=GetIdStr(d);if(g){TraverseNodes(e,g)}else{console.log("加载错误："+e.parentNode.id);console.log("Support a maximum of 5 evg files");return}g_WldSvg.push(CreateSvg(e,g))}if(g_WldSvg.length>5){for(var d=0;d<g_WldSvg.length;d++){g_WldSvg[d].Destroy()}return}}else{console.log("全局加载");g_WldWsServer=(typeof(GLOBAL_USER_PROFILE)!="undefined")?("ws:"+GLOBAL_USER_PROFILE.wss.rtdata[0]+":"+GLOBAL_USER_PROFILE.wss.WS_RTDB):g_WldWsServer;if(g_WldWsServer=="undefined"){alert("加载IP地址和端口号出错！")}var b=document.childNodes[0];for(var d=0;d<g_WldSvg.length;d++){g_WldSvg[d].Destroy()}g_WldSvg=[];var c=document.getElementsByClassName("class_svg");if(c.length>0){var g,f;if(c.length==1){f=CreateSvg(c[0]);if(f){g_WldSvg.push(f)}}else{for(var d=0;d<c.length;d++){if(d>0){g=GetIdStr(d);if(g){TraverseNodes(c[d],g)}else{console.log("Support a maximum of 5 evg files");return}}var f=CreateSvg(c[d],g);if(f){g_WldSvg.push(f)}}}}}}function TraverseNodes(c,e){if(c.nodeType==1){if(c.id){if(c.id.substr(0,5)=="Graph"){c.id=e+c.id}else{if(c.id.substr(0,5)=="Chart"){c.id=e+c.id}}}if(c.hasChildNodes){var b=c.childNodes;for(var a=0;a<b.length;a++){var d=b.item(a);TraverseNodes(d,e)}}}}function CreateSvg(l,j){var o,d,g,m;for(var c=0;c<l.childNodes.length;c++){if(l.childNodes[c].nodeName=="script"){o=l.childNodes[c]}}if(o){g=d=new WldSvg();g.Dom=l;g.IdStr=j;g.ParentId=l.parentNode.id;m=o.textContent;if(m.substr(0,3)!="<!["){g_WldGraphID=[],g_WldChartID=[];var b=new Function(m);b();var n=g_WldGraphID;var a=g_WldChartID;if(j){for(var c=0;c<n.length;c++){n[c]=j+n[c]}}g.Init(n,a)}g.ViewBox=g.Dom.getAttribute("viewBox").split(" ");var k=0,h=0;for(var f=g.Dom;f;f=f.offsetParent){k+=f.offsetLeft;h+=f.offsetTop;if(f.scrollLeft){k-=f.scrollLeft}if(f.scrollTop){h-=f.scrollTop}}g.dx=Math.abs(g.Dom.getBoundingClientRect().left-k);g.dy=Math.abs(g.Dom.getBoundingClientRect().top-h);g.OnSize()}return g}function eGraph_CreateWebsocket(a){if(a){var b=GetSvg(a);if(b&&b.AssPoint){b.AssPoint.CreateWebsocket()}}else{for(i=0;i<g_WldSvg.length;i++){g_WldSvg[i].AssPoint.CreateWebsocket()}}}function eGraph_DestroyWebsocket(a){console.log("销毁Websocket");console.log("--------------------------------");if(a){var b=GetSvg(a);if(b&&b.AssPoint){b.AssPoint.DestroyWebsocket()}}else{for(i=0;i<g_WldSvg.length;i++){g_WldSvg[i].AssPoint.DestroyWebsocket()}}}function WldSvg(){var a=this;a.Dom=null;a.AssPoint=null;a.Graphs=[];a.Charts=[];a.Rect={};a.OffParentH=0;a.OffParentW=0}WldSvg.prototype.Init=function(r,a){var l,n=this;n.AssPoint=new AssPoint();var o=true;var e=[],b;for(l=0;l<r.length;l++){var k=document.getElementById(r[l]);if(!k){return}k.OldStyle=(k.style)?k.style.cssText:"";var p=k.attributes;var g="";var q="";for(var h=0;h<p.length;h++){if(p[h].name=="click"){if(p[h].nodeValue!="func-yktoolbar"){k.setAttribute("click","Graph_Click(evt"+p[h].nodeValue+")")}}else{if(p[h].name=="contrlMap"){g=p[h].nodeValue;break}}}var m=g.replace(/'/g,'"');var d=JSON.parse(m);e=n.DealWithAss(k,r[l],d);n.Graphs[l]=new SvgGraph(k,r[l],d,e);n.DealWithPoint(n.Graphs[l],e,o)}o=false;for(l=0;l<a.length;l++){var c=a[l];var k=document.getElementById(c);if(k.classList.contains("CurveDB")){n.Charts[l]=new ChartCurveDB(k,a[l])}else{if(k.classList.contains("Curve")){n.Charts[l]=new ChartCurve(k,a[l])}else{if(k.classList.contains("Stick")){n.Charts[l]=new ChartStick(k,a[l])}else{if(k.classList.contains("Pie")){n.Charts[l]=new ChartPie(k,a[l])}}}}n.Charts[l].Init();e=[];for(var h=0;h<n.Charts[l].Series.length;h++){var f=n.Charts[l].Series[h].Serie;if(f&&f.AssPoint){e.push(n.Charts[l].Series[h].Serie.AssPoint)}}if(k.classList.contains("CurveDB")){n.Charts[l].Points=e}else{n.DealWithPoint(n.Charts[l],e,o);n.Charts[l].Dynamic()}}n.AssPoint.Init()};WldSvg.prototype.SvgResize=function(){var a=this;a.ReSize()};WldSvg.prototype.OnSize=function(){var b=this;b.ReSize();var a=0,d=0;for(var c=b.Dom;c;c=c.offsetParent){a+=c.offsetLeft;d+=c.offsetTop;if(c.scrollLeft){a-=c.scrollLeft}if(c.scrollTop){d-=c.scrollTop}}b.sumLeft=a+b.dx;b.sumTop=d+b.dy};WldSvg.prototype.ReSize=function(){var c=this;var b=((c.Dom.parentNode==document.body)&&(document.body==c.Dom.offsetParent))?c.Dom:c.Dom.parentNode;if(b){var a=b.getBoundingClientRect();c.Rect.Width=a.width;c.Rect.Height=a.height;c.Rect.WidthRatio=c.Rect.Width/c.ViewBox[2];c.Rect.HightRatio=c.Rect.Height/c.ViewBox[3];c.Rect.Ratio=c.Rect.WidthRatio>c.Rect.HightRatio?c.Rect.HightRatio:c.Rect.WidthRatio;c.Rect.Ratio=+c.Rect.Ratio.toFixed(4)}};WldSvg.prototype.Move=function(){var a=this;a.tx=+a.Dom.attributes.transformx.value;a.ty=+a.Dom.attributes.transformy.value};WldSvg.prototype.Scale=function(){var a=this;a.Scalek=+a.Dom.attributes.scalek.value;a.Ratio=a.Rect.Ratio*a.Scalek};WldSvg.prototype.DealWithAss=function(h,o,c){var l=this;var k=[];if(c.LineColor&&c.LineColor.point){c.LineDom=h;if(h.classList.contains("svgtext")){c.LineDom=DealWithText(h).rect}k.push(c.LineColor.point)}if(c.FillColor&&c.FillColor.point){c.FillDom=h;if(h.classList.contains("svgtext")){c.FillDom=DealWithText(h).rect}k.push(c.FillColor.point)}if(c.FontColor&&c.FontColor.point){c.FontDom=h;if(h.classList.contains("svgtext")){c.FontDom=DealWithText(h).text}k.push(c.FontColor.point)}if(c.FillPercent&&c.FillPercent.point){k.push(c.FillPercent.point)}if(c.Size&&c.Size.point){k.push(c.Size.point)}if(c.Position&&c.Position.point){k.push(c.Position.point)}if(c.Display&&c.Display.point){k.push(c.Display.point)}if(c.Format&&c.Format.point){k.push(c.Format.point)}if(c.SwitchGraph&&c.SwitchGraph.point){c.SwitchGraph.SwitchDom=document.getElementById(o+"_switch");k.push(c.SwitchGraph.point)}if(c.SwitchText&&c.SwitchText.point){var d=DealWithText(h);h.POldStyle=d.rect.style.cssText;for(var e=0;e<d.text.childNodes.length;e++){if(d.text.childNodes[e].nodeName=="tspan"){c.SwitchText.TspanDom=d.text.childNodes[e];if(c.SwitchText.TspanDom.textContent!=c.SwitchText.Value){c.SwitchText.OldText=c.SwitchText.TspanDom.textContent}}}k.push(c.SwitchText.point)}if(c.Flash&&c.Flash.point){k.push(c.Flash.point)}if(c.Swing&&c.Swing.point){k.push(c.Swing.point)}if(c.Tanslate&&c.Tanslate.point){k.push(c.Tanslate.point)}if(c.Rotate&&c.Rotate.point){k.push(c.Rotate.point)}if(c.Flow&&c.Flow.point){k.push(c.Flow.point)}var n="",a=[];for(var g=0;g<k.length;g++){var m=true;n=k[g];for(var e=0;e<a.length;e++){if(n==a[e].Point){m=false}}if(m){var f;if(n.substr(0,3)=="rtu"){f=new RtuPoint(n)}else{if(n.substr(0,2)=="cl"||n.substr(0,2)=="ca"||n.substr(0,2)=="cm"){f=new CalculatePoint(n)}else{f=new CommonPoint(n)}}a.push(f)}}return a};WldSvg.prototype.DealWithPoint=function(c,f,g){var a=true,h=this;for(var e=0;e<f.length;e++){var k=[];if(f[e].Type=="yx"){k=h.AssPoint.YxPoint.Points}else{if(f[e].Type=="yc"){k=h.AssPoint.YcPoint.Points}else{if(f[e].Type=="mc"){k=h.AssPoint.McPoint.Points}else{if(f[e].Type=="rtu"){k=h.AssPoint.RtuPoint.Points}else{if(f[e].Type=="cl"){k=h.AssPoint.ClPoint.Points}else{if(f[e].Type=="ca"){k=h.AssPoint.CaPoint.Points}else{if(f[e].Type=="cm"){k=h.AssPoint.CmPoint.Points}}}}}}}for(var d=0;d<k.length;d++){if(f[e].Point==k[d].Point){if(g){k[d].Graphs.push(c)}else{k[d].Charts.push(c)}a=false}}if(a){if(g){f[e].Graphs.push(c)}else{f[e].Charts.push(c)}k.push(f[e])}}};WldSvg.prototype.Destroy=function(){var a=this;if(a.AssPoint){a.AssPoint.Destroy();a.AssPoint=null}for(i=0;i<a.Graphs.length;i++){a.Graphs[i].Destroy()}a.Graphs=[];for(i=0;i<a.Charts.length;i++){a.Charts[i].Destroy()}a.Charts=[];a.Dom=null;a.Rect=null};function SvgGraph(b,d,e,a){var c=this;c.Dom=b;c.GraphID=d;c.Ass=e;c.Points=a}SvgGraph.prototype.Destroy=function(){var b=this;for(var a in b.Ass){if(a=="Flash"){if(b.Ass[a].FlashTimeId){clearInterval(b.Ass[a].FlashTimeId)}}else{if(a=="Tanslate"){if(b.Ass[a].TanslateTimeId){clearInterval(b.Ass[a].TanslateTimeId)}}else{if(a=="Flow"){if(b.Ass[a].TimeId){clearInterval(b.Ass[a].TimeId)}}}}}};SvgGraph.prototype.Dynamic=function(c){var d=this;for(var b=0;b<d.Points.length;b++){if(c.iid!=d.Points[b].Point){continue}for(var a in d.Ass){var e=d.Ass[a];if(typeof(d.Ass[a].point)!="undefined"&&e.point==d.Points[b].Point){if(+c.biIV==1){d.Dom.setAttribute("invalid",1)}if(d.Points[0].Type=="rtu"){c.value=+c.biCommOK}if(a=="LineColor"){d.LineColor(c,e)}else{if(a=="FillColor"){d.FillColor(c,e)}else{if(a=="FontColor"){d.FontColor(c,e)}else{if(a=="FillPercent"){d.FillPercent(c,e)}else{if(a=="Size"){d.Size(c,e)}else{if(a=="Position"){d.Position(c,e)}else{if(a=="Display"){d.Display(c,e)}else{if(a=="Format"){d.Format(c,e)}else{if(a=="SwitchGraph"){d.SwitchGraph(c,e)}else{if(a=="SwitchText"){d.SwitchText(c,e)}else{if(a=="Flash"){d.Flash(c,e)}else{if(a=="Swing"){d.Swing(c,e)}else{if(a=="Tanslate"){d.Tanslate(c,e)}else{if(a=="Rotate"){d.Rotate(c,e)}else{if(a=="Flow"){d.Flow(c,e)}}}}}}}}}}}}}}}}d.Ass[a].OldValue=c.value}}};SvgGraph.prototype.LineColor=function(b,d){var a;var c=DealWithPolar(d.Polar,+b.value);if(+b.biIV==0){if(typeof(b.biLimitStatus)!="undefined"){a=DealWithLimitStatus(+b.biLimitStatus,d)}else{a=DealWithOnOff(c,d)}}else{a="rgb(120,120,120)"}this.Ass.LineDom.style.stroke=a};SvgGraph.prototype.FillColor=function(b,d){var a;var c=DealWithPolar(d.Polar,+b.value);if(+b.biIV==0){if(typeof(b.biLimitStatus)!="undefined"){a=DealWithLimitStatus(+b.biLimitStatus,d)}else{a=DealWithOnOff(c,d)}}else{a="rgb(120,120,120)"}this.Ass.FillDom.style.fill=a};SvgGraph.prototype.FontColor=function(b,d){var a;if(+b.biIV==1){return}var c=DealWithPolar(d.Polar,+b.value);if(typeof(b.biLimitStatus)!="undefined"){a=DealWithLimitStatus(+b.biLimitStatus,d)}else{a=DealWithOnOff(c,d)}this.Ass.FontDom.style.fill=a};SvgGraph.prototype.FillPercent=function(a,b){console.log("空间关联——填充度 功能暂未实现！")};SvgGraph.prototype.Size=function(a,b){console.log("空间关联——尺寸 功能暂未实现！")};SvgGraph.prototype.Position=function(a,b){console.log("空间关联——位置 功能暂未实现！")};SvgGraph.prototype.Display=function(a,c){var b=+a.value;if(typeof(a.biCurWarn)!="undefined"){b=DealWithPolar(c.Polar,b);if(b==1){this.Dom.style.display="none"}else{this.Dom.style.display=""}}};SvgGraph.prototype.Format=function(b,e){var d=+b.value;var c=DealWithText(this.Dom);if(+b.biIV==1){e.OldStroke=c.rect.style.stroke;e.OldFill=c.rect.style.fill;style="rgb(120,120,120)";c.rect.style.stroke=style;c.rect.style.fill=style}else{if(e.OldStroke!=c.rect.style.stroke){c.rect.style.stroke=e.OldStroke}if(e.OldFill!=c.rect.style.fill){c.rect.style.fill=e.OldFill}}var f=+e.FormatStr;if(f==0){d=d.toFixed(0)}else{if(f==1){d=d.toFixed(1)}else{if(f==2){d=d.toFixed(2)}else{if(f==3){d=d.toFixed(3)}else{if(f==4){d=d.toFixed(4)}else{if(f==5){d=Math.round(parseFloat(d)*10)/10}else{if(f==6){d=Math.round(parseFloat(d)*100)/100}else{if(f==7){d=Math.round(parseFloat(d)*1000)/1000}else{if(f==8){d=Math.round(parseFloat(d)*10000)/10000}else{if(f==15){var a=new Date();d=(a.getFullYear()+"年")+(a.getMonth()+1)+"月"+a.getDate()+"日 "+CheckTime(a.getHours())+":"+CheckTime(a.getMinutes())+":"+CheckTime(a.getSeconds())}else{if(f==16){var a=new Date();d=(a.getFullYear()+"-")+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}}}}}}}}}}}var g=c.text.childNodes[0].nodeName=="tspan"?c.text.childNodes[0]:c.text.childNodes[1];g.textContent=(e.Prefix?e.Prefix:"")+d+(e.Suffix?e.Suffix:"")};SvgGraph.prototype.SwitchGraph=function(a,d){var b=this;var c=DealWithPolar(d.Polar,+a.value);if(+a.biIV==1){return}if(c==1){b.Dom.setAttribute("display","none");if(d.SwitchDom){d.SwitchDom.setAttribute("display","true")}else{console.log("未找到"+b.GraphID+"的切换图元，请检查配置文件！")}}else{b.Dom.setAttribute("display","true");if(d.SwitchDom){d.SwitchDom.setAttribute("display","none")}else{console.log("未找到"+b.GraphID+"的切换图元，请检查配置文件！")}}};SvgGraph.prototype.SwitchText=function(a,c){if(+a.biIV==1){return}if(typeof(a.biCurWarn)!="undefined"){var b=DealWithPolar(c.Polar,+a.value);if(b==1){c.TspanDom.textContent=c.Value?c.Value:"";this.Dom.style.fill=c.StrokeTo}else{c.TspanDom.textContent=c.OldText;this.Dom.style.cssText=this.Dom.OldStyle}}};SvgGraph.prototype.Flash=function(b,e){var c=this;var d=DealWithPolar(e.Polar,+b.value);if(+b.biIV==1){return}if(b.biConfirmed){if(e.FlashTimeId){clearInterval(e.FlashTimeId)}if(c.Ass.SwitchGraph&&c.Ass.SwitchGraph.SwitchDom){if(d==0){c.Dom.setAttribute("display","true");c.Ass.SwitchGraph.SwitchDom.setAttribute("display","none")}else{c.Dom.setAttribute("display","none");c.Ass.SwitchGraph.SwitchDom.setAttribute("display","true")}}else{c.Dom.setAttribute("display","true")}}else{if(+b.biCurWarn||c.Points[0].Type=="rtu"){e.nCount=0;var a=DealWithFrequency(e);if(e.FlashTimeId){clearInterval(e.FlashTimeId)}e.FlashTimeId=setInterval(function(){c.FlashDynamic(e,d)},a)}}};SvgGraph.prototype.FlashDynamic=function(c,b){var a=this;if(c.nCount%2==0){if(a.Ass.SwitchGraph&&a.Ass.SwitchGraph.SwitchDom){if(b==1){a.Ass.SwitchGraph.SwitchDom.setAttribute("display","true")}else{a.Dom.setAttribute("display","true")}}else{a.Dom.setAttribute("display","true")}}else{if(a.Ass.SwitchGraph&&a.Ass.SwitchGraph.SwitchDom){if(b==1){a.Ass.SwitchGraph.SwitchDom.setAttribute("display","none")}else{a.Dom.setAttribute("display","none")}}else{a.Dom.setAttribute("display","none")}}c.nCount++};SvgGraph.prototype.Swing=function(a,b){alert("Swing功能暂未实现！")};SvgGraph.prototype.Tanslate=function(b,e){var d=+b.value;var c=this;if(+b.biIV==1){return}if(e.arrIID[e.index].OldValue!=d){d=DealWithPolar(e.Polar,d);if(d==1){e.nCount=0;var a=DealWithFrequency(e);if(e.TanslateTimeId){clearInterval(e.TanslateTimeId)}e.TanslateTimeId=setInterval(function(){c.Move(e)},a)}else{var f="translate(0,0)";c.MoveBegin(f);if(e.TanslateTimeId){clearInterval(e.TanslateTimeId)}}}};SvgGraph.prototype.Move=function(a){this.Dom.setAttribute("transform",this.MoveBase(a))};SvgGraph.prototype.MoveBegin=function(a){this.Dom.setAttribute("transform",a)};SvgGraph.prototype.MoveBase=function(b){var a=0,c=0;if(+b.Dir==0){a=(+b.Offset)/5*((this.nCount)%5)}else{if(+b.Dir==1){a=(+b.Offset)/5*(5-(this.nCount)%5)}else{if(+b.Dir==2){c=(+b.Offset)/5*((this.nCount)%5)}else{c=(+b.Offset)/5*(5-(this.nCount)%5)}}}this.nCount++;return"translate("+a+","+c+")"};SvgGraph.prototype.Rotate=function(a,b){alert("Rotate功能暂未实现！")};SvgGraph.prototype.Flow=function(b,c){var d=this.Dom.style.fill;var f=d.slice(6,-2);var e=document.getElementById(f).childNodes[1];if(+b.biIV==1){return}this.nCount=0;this.FlushTime=200;var a=this;if(c.TimeId){clearInterval(c.TimeId)}c.TimeId=setInterval(function(){a.DynamicFlow(e)},this.FlushTime)};SvgGraph.prototype.DynamicFlow=function(b){var a;if(this.nCount<90){a=5+this.nCount+"%"}else{this.nCount=0;a=0}this.nCount+=5;b.setAttribute("offset",a)};function AssPoint(){var a=this;a.YxPoint=new PointTypeBase("yx");a.YcPoint=new PointTypeBase("yc");a.McPoint=new PointTypeBase("mc");a.RtuPoint=new RtuPointObj("rtu");a.ClPoint=new CalculatePointObj("cl");a.CaPoint=new CalculatePointObj("ca");a.CmPoint=new CalculatePointObj("cm")}AssPoint.prototype.Destroy=function(){var a=this;a.YxPoint.Destroy();a.YxPoint=null;a.YcPoint.Destroy();a.YcPoint=null;a.McPoint.Destroy();a.McPoint=null;a.RtuPoint.Destroy();a.RtuPoint=null;a.ClPoint.Destroy();a.ClPoint=null;a.CaPoint.Destroy();a.CaPoint=null;a.CmPoint.Destroy();a.CmPoint=null};AssPoint.prototype.Init=function(){var a=this;a.YxPoint.Init();a.YcPoint.Init();a.McPoint.Init();a.RtuPoint.Init();a.ClPoint.Init();a.CaPoint.Init();a.CmPoint.Init()};AssPoint.prototype.CreateWebsocket=function(){var a=this;a.YxPoint.CreateWebsocket();a.YcPoint.CreateWebsocket();a.McPoint.CreateWebsocket();a.RtuPoint.CreateWebsocket();a.ClPoint.CreateWebsocket();a.CaPoint.CreateWebsocket();a.CmPoint.CreateWebsocket()};AssPoint.prototype.DestroyWebsocket=function(){var a=this;a.YxPoint.DestroyWebsocket();a.YcPoint.DestroyWebsocket();a.McPoint.DestroyWebsocket();a.RtuPoint.DestroyWebsocket();a.ClPoint.DestroyWebsocket();a.CaPoint.DestroyWebsocket();a.CmPoint.DestroyWebsocket()};function PointTypeBase(b){var a=this;a.Points=[];a.PointGroup=[];a.StrStart='{"B":4,"request":{"'+b+'":[';a.StrEnd="]}}"}PointTypeBase.prototype.Destroy=function(){this.DestroyWebsocket();this.PointGroup=[]};PointTypeBase.prototype.Init=function(){var e=this,b,d="",f=[];var a=MyConstant.getConstants("SOCKET_GROUP_NUM");var c;for(c=0;c<e.Points.length;c++){f.push(e.Points[c]);if(c==e.Points.length-1){d+=e.Points[c].SendStr;b=new PointGroup(f,e.StrStart+d+e.StrEnd);e.PointGroup.push(b)}else{if((c+1)%a==0){d+=e.Points[c].SendStr;b=new PointGroup(f,e.StrStart+d+e.StrEnd);e.PointGroup.push(b);b=null;f=[];d=""}else{d+=e.Points[c].SendStr+","}}}e.CreateWebsocket()};PointTypeBase.prototype.CreateWebsocket=function(){for(i=0;i<this.PointGroup.length;i++){this.PointGroup[i].CreateWebsocket()}};PointTypeBase.prototype.DestroyWebsocket=function(){for(var a=0;a<this.PointGroup.length;a++){this.PointGroup[a].DestroyWebsocket()}};function RtuPointObj(b){var a=this;PointTypeBase.call(a,b)}RtuPointObj.prototype=new PointTypeBase();function CalculatePointObj(b){var a=this;PointTypeBase.call(a,b)}CalculatePointObj.prototype=new PointTypeBase();function PointBase(b){var a=this;a.Point=b;a.Graphs=[];a.Charts=[]}function CommonPoint(c){var b=this;PointBase.call(b,c);var a=b.Point.split(/[:,]/i);b.Type=a[0];b.Station=a[2];b.No=a[4];b.Channel=a[6];b.Rtu=a[8];b.Address=a[10];b.SendStr='{"station":'+b.Station+',"no":'+b.No+',"channel":'+b.Channel+',"rtu":'+b.Rtu+',"address":'+b.Address+"}";b.SendHis='{"station":'+b.Station+',"no":'+b.No+"}"}function RtuPoint(c){var b=this;PointBase.call(b,c);var a=this.Point.split(/[:,]/i);b.Type=a[0];b.Channel=a[2];b.No=a[4];b.SendStr='{"channel":'+b.Channel+',"no":'+b.No+"}"}function CalculatePoint(c){var b=this;PointBase.call(b,c);var a=this.Point.split(/[:,]/i);b.Type=a[0];b.Station=a[2];b.No=a[4];b.SendStr='{"station":'+b.Station+',"no":'+b.No+"}"}function PointGroup(a,b){var c=this;c.Points=a;c.WebSocket=null;c.SendStr=b;c.MsgCount=1;c.MsgLastCount=0;c.CheckTimeID=0}PointGroup.prototype.Init=function(){var a=this;a.CreateWebsocket()};PointGroup.prototype.Destroy=function(){var a=this;a.DestroyWebsocket()};PointGroup.prototype.CreateWebsocket=function(){var a=this;if(a.WebSocket){if(a.CheckTimeID&&a.WebSocket.readyState==1){return}else{a.WebSocket.close();a.WebSocket=null}}a.WebSocket=new WebSocket(g_WldWsServer);a.WebSocket.onopen=function(b){a.Send()};a.WebSocket.onmessage=function(b){a.OnMessage(JSON.parse(b.data))};if(a.CheckTimeID){clearInterval(a.CheckTimeID)}a.CheckTimeID=setInterval(function(){a.CheckStatus()},MyConstant.getConstants("CHECKSTATU_TIME"))};PointGroup.prototype.DestroyWebsocket=function(){var a=this;if(a.CheckTimeID){clearInterval(a.CheckTimeID)}if(a.WebSocket){a.WebSocket.close();a.WebSocket=null}};PointGroup.prototype.Send=function(){var a=this;a.WebSocket.send(a.SendStr)};PointGroup.prototype.OnMessage=function(e){var d=this;d.MsgCount++;if(d.MsgCount>1000000){d.MsgCount=0}for(var c=0;c<e.values.length;c++){for(var b=0;b<d.Points.length;b++){if(d.Points[b].Point==e.values[c].iid){for(var a=0;a<d.Points[b].Graphs.length;a++){d.Points[b].Graphs[a].Dynamic(e.values[c])}for(var a=0;a<d.Points[b].Charts.length;a++){d.Points[b].Charts[a].UpdateValue(e.values[c])}}}}};PointGroup.prototype.CheckStatus=function(){var a=this;if(a.MsgCount==a.MsgLastCount){if(a.WebSocket.readyState==1){a.Send()}else{a.DestroyWebsocket();a.CreateWebsocket()}}a.MsgLastCount=a.MsgCount};function PoltPaper(a){var b=this;b.Dom=a;b.Rect={};b.XAxis=null;b.YAxis=null;b.Limit=null;b.RatioX=0;b.RatioY=0;b.PerGridX=0;b.OriginX=0;b.OriginY=0;b.EndX=0;b.EndY=0}PoltPaper.prototype.Init=function(){var c=this;c.RatioY=+c.Dom.getAttribute("ratio_y");c.OriginX=+c.Dom.getAttribute("origin_x");c.OriginY=+c.Dom.getAttribute("origin_y");c.EndX=+c.Dom.getAttribute("end_x");c.EndY=+c.Dom.getAttribute("end_y");c.PerGridX=+c.Dom.getAttribute("per_gridx");for(var a=0;a<c.Dom.childNodes.length;a++){var b=c.Dom.childNodes[a];if(b.nodeName=="rect"){c.Rect=b}else{if(b.classList.contains("XAxis")){c.XAxis=new PoltAxis(b);c.XAxis.Init(c)}else{if(b.classList.contains("YAxis")){c.YAxis=new PoltAxis(b);c.YAxis.Init(c)}else{if(b.classList.contains("Limit")){c.Limit=b;c.Limit.Value=+b.getAttribute("limitvalue")}}}}}};PoltPaper.prototype.UpdateXAxisTime=function(a){var b=this;if(b.XAxis){b.XAxis.UpdateTime(a)}};PoltPaper.prototype.UpdateYAxis=function(){var a=this;if(a.YAxis){a.YAxis.UpdateGraduationValue(a)}};function PoltAxis(a){var b=this;b.Dom=a;b.Axis=null;b.Calibrate=null;b.Text=null;b.Lable=null;b.Min=0;b.Max=0}PoltAxis.prototype.Init=function(h){var f=this;for(var d=0;d<f.Dom.childNodes.length;d++){var e=f.Dom.childNodes[d];if(e.nodeName=="text"){f.Lable=e}else{if(e.nodeName=="line"){f.Axis=e}else{if(e.classList.contains("Calibrate")){var g=[];f.Calibrate=e;for(var c=0;c<e.childNodes.length;c++){var b=e.childNodes[c];g.push(b)}f.Calibrate.DeCalibrates=g}else{if(e.classList.contains("Text")){var a=[];f.Text=e;f.Text.DeFormat=e.getAttribute("index");f.Min=+e.childNodes[0].textContent;f.Max=+e.childNodes[e.childNodes.length-1].textContent}}}}}};PoltAxis.prototype.UpdateTime=function(c){var f=this;if(f.Text){var e=f.Text;for(var d=0;d<e.childNodes.length;d++){var b=c.getTime()-(e.childNodes.length-(d+1))*1000;var a=new Date(b);e.childNodes[d].textContent=f.Format(a)}}};PoltAxis.prototype.UpdateTimeEx=function(a){var d=this;if(d.Text){var c=d.Text;var e="";for(var b=0;b<c.childNodes.length;b++){if(b==c.childNodes.length-1){e=d.Format(a)}else{e=c.childNodes[b+1].textContent}c.childNodes[b].textContent=e}}};PoltAxis.prototype.UpdateGraduationValue=function(h){var d=this;if(d.Text){var c=d.Text;var g=d.Max-d.Min;var a=+(g/(c.childNodes.length-1)).toFixed(6);var e=0;var f=+c.childNodes[c.childNodes.length-1].getAttribute("y");h.RatioY=+((h.OriginY-f)/g).toFixed(6);for(var b=0;b<c.childNodes.length;b++){e=d.Min+a*b;c.childNodes[b].textContent=d.Format(e)}if(h.Limit){e=(h.Limit.Value-d.Min).toFixed(2);e=e>0?e:0;f=(h.OriginY-e*h.RatioY).toFixed(2);h.Limit.setAttribute("y1",f);h.Limit.setAttribute("y2",f)}}};PoltAxis.prototype.Format=function(a){var b=this;var c="";if(b.Text.DeFormat==0){c=(a.getFullYear()+"-").substr(2)+(a.getMonth()+1)+"-"+a.getDate()+" "+CheckTime(a.getHours())+":"+CheckTime(a.getMinutes())+":"+CheckTime(a.getSeconds())}else{if(b.Text.DeFormat==1){c=(a.getFullYear()+"-").substr(2)+(a.getMonth()+1)+"-"+a.getDate()}else{if(b.Text.DeFormat==2){c=CheckTime(a.getHours())+":"+CheckTime(a.getMinutes())+":"+CheckTime(a.getSeconds())}else{if(b.Text.DeFormat==3){c=CheckTime(a.getMinutes())+":"+CheckTime(a.getSeconds())}else{if(b.Text.DeFormat==7){c=CheckTime(a.getSeconds())}else{if(b.Text.DeFormat==8){c=a.toFixed()}else{if(b.Text.DeFormat==9){c=a.toFixed(1)}else{if(b.Text.DeFormat==10){c=a.toFixed(2)}else{if(b.Text.DeFormat==11){c=a.toFixed(3)}else{if(b.Text.DeFormat==12){c=a.toFixed(4)}}}}}}}}}}return c};function PoltSeri(a){var b=this;b.Dom=a;b.Serie=null;b.Value=null;b.bStop=false}PoltSeri.prototype.Init=function(){var k=this;for(var f=0;f<k.Dom.childNodes.length;f++){var c=k.Dom.childNodes[f];if(c.nodeName=="path"||c.nodeName=="rect"){k.Serie=c;var h=c.getAttribute("point");if(h){if(h.substr(0,3)=="rtu"){k.Serie.AssPoint=new RtuPoint(h)}else{k.Serie.AssPoint=new CommonPoint(h)}}else{alert("图表未完成关联点的配置！");return}if(c.nodeName=="rect"){}else{var l=c.getAttribute("d");if(+k.Dom.getAttribute("slick")){var g=l.split(",");var b=l.split(",");k.Serie.Points=g;k.Serie.TempPoints=b;for(var e=0;e<g.length;e++){k.Serie.Points[e]=g[e].split(" ");k.Serie.TempPoints[e]=b[e].split(" ")}var d=smooth(k.Serie.Points,3);k.Serie.setAttribute("d",d)}else{k.Serie.Points=l.split(/[ ,]/g);k.Serie.TempPoints=l.split(/[ ,]/g)}}}else{if(c.classList.contains("Value")){var a=[];k.Value=c;if(k instanceof PoltSeriStick){c.Value=+c.textContent;a.push(c)}else{for(var e=0;e<c.childNodes.length;e++){var m=c.childNodes[e];m.Value=+m.textContent;a.push(m)}}k.Value.DeValues=a}}}};PoltSeri.prototype.UpdateValue=function(b,d){var c=this;var a=+(d).toFixed(2);c.Value.DeValues[c.Value.DeValues.length-1].Value=a;if(a<b.PoltPaper.YAxis.Min){b.PoltPaper.YAxis.Min=a;b.PoltPaper.UpdateYAxis()}else{if(a>b.PoltPaper.YAxis.Max){b.PoltPaper.YAxis.Max=a;b.PoltPaper.UpdateYAxis()}}};PoltSeri.prototype.Draw=function(o,p,b){var m=this;var k=m.Value.childNodes.length;var l=(+m.Value.DeValues[k-1].Value).toFixed(1);var q=+(o.OriginY-(l-o.YAxis.Min)*o.RatioY).toFixed(1);var f=m.Serie;if(+m.Dom.getAttribute("slick")){if(b){var d=k-(p-1);var h=d-1;for(var g=0;g<d;g++){if(p==1){m.Value.childNodes[g].textContent=l;f.Points[g][1]=+f.TempPoints[h][5];f.Points[g][2]=q;if(g!=0){f.Points[g][3]=+f.TempPoints[h][5];f.Points[g][4]=q;f.Points[g][5]=+f.TempPoints[h][5];f.Points[g][6]=q}}else{if(h==0){f.Points[g][1]=+f.TempPoints[h][1]}else{if(g==0){f.Points[g][1]=+f.TempPoints[h][5]}else{f.Points[g][3]=+f.TempPoints[h][5];f.Points[g][5]=+f.TempPoints[h][5]}}}}}for(var g=0;g<k;g++){var a=m.Value.childNodes[g];if(p!=1){if(g==k-1){a.textContent=l}else{a.textContent=m.Value.childNodes[g+1].textContent}var c=(o.OriginY-(+a.textContent-o.YAxis.Min)*o.RatioY).toFixed(1);if(g==0){f.Points[g][2]=c}else{f.Points[g][2]=c;f.Points[g][4]=c;f.Points[g][6]=c}}if(g==0){a.setAttribute("y",f.Points[g][2])}else{a.setAttribute("y",f.Points[g][6])}}var e=smooth(f.Points,3);f.setAttribute("d",e)}else{if(b){var d=k-(p-1);var h=(d-1)*2;for(var g=0;g<d;g++){if(p==1){m.Value.childNodes[g].textContent=l}if(g==0){f.Points[g*2]="M"+f.TempPoints[h].substr(1)}else{f.Points[g*2]="L"+f.TempPoints[h].substr(1)}f.Points[g*2+1]=q}}for(var g=0;g<k;g++){var a=m.Value.childNodes[g];if(p!=1){if(g==k-1){a.textContent=l}else{a.textContent=m.Value.childNodes[g+1].textContent}}f.Points[g*2+1]=(o.OriginY-(+a.textContent-o.YAxis.Min)*o.RatioY).toFixed(1);a.setAttribute("y",f.Points[g*2+1])}f.setAttribute("d",f.Points)}};function PoltSeriCurveDB(a){var b=this;PoltSeri.call(b,a)}PoltSeriCurveDB.prototype=new PoltSeri();function PoltSeriStick(a){var b=this;PoltSeri.call(b,a)}PoltSeriStick.prototype=new PoltSeri();PoltSeriStick.prototype.Draw=function(f){var e=this;var a=e.Value.childNodes.length;var c=(+e.Value.DeValues[a-1].Value).toFixed(1);var b=+(f.OriginY-(c-f.YAxis.Min)*f.RatioY).toFixed(1);var d=f.OriginY-b;d=(d>0?d:-d).toFixed(1);if(f.OriginY-b>=0){e.Serie.setAttribute("y",b);e.Serie.setAttribute("height",d);e.Value.setAttribute("y",b-5);e.Value.textContent=c}else{e.Serie.setAttribute("y",f.OriginY);e.Serie.setAttribute("height",d);e.Value.setAttribute("y",f.OriginY-5);e.Value.textContent=c}};function PoltSeriPie(a){var b=this;PoltSeri.call(b,a)}PoltSeriPie.prototype=new PoltSeri();function SvgChart(a,c){var b=this;b.Dom=a;b.ChartID=c;b.Points=[];b.PoltPaper=null;b.Series=[];b.Prompt={};b.TimeId=0}SvgChart.prototype.Destroy=function(){var a=this;if(a.TimeId){clearInterval(a.TimeId)}};SvgChart.prototype.BaseInit=function(){var g=this;for(var e=0;e<g.Dom.childNodes.length;e++){var f=g.Dom.childNodes[e];if(f.classList.contains("time")){g.Time=new SelectTime(f);g.Time.Init()}else{if(f.classList.contains("PoltPaper")){g.PoltPaper=new PoltPaper(f);g.PoltPaper.Init();if(this instanceof ChartCurveDB){var d=new Date(g.Time.StartTime.text.textContent);g.PoltPaper.UpdateXAxisTime(d)}}else{if(f.classList.contains("Serie")){if(this instanceof ChartCurve){var a=new PoltSeri(f)}else{if(this instanceof ChartCurveDB){var a=new PoltSeriCurveDB(f)}else{if(this instanceof ChartStick){var a=new PoltSeriStick(f)}else{if(this instanceof ChartPie){var a=new PoltSeriPie(f)}}}}a.Init();g.Series.push(a)}else{if(f.classList.contains("Prompt")){g.Prompt=f;for(var c=0;c<f.childNodes.length;c++){var b=f.childNodes[c];if(b.classList.contains("Horizontal")){g.Prompt.Horizontal=b}else{if(b.classList.contains("Vertical")){g.Prompt.Vertical=b}}if(b.nodeName=="use"){g.Prompt.Prompt=b}}}}}}}};SvgChart.prototype.UpdateValue=function(b){var c=this;for(var a=0;a<c.Series.length;a++){if(c.Series[a].Serie.AssPoint.Point==b.iid){c.Series[a].UpdateValue(c,+b.value)}}};SvgChart.prototype.DynamicBase=function(){var a=this;if(a.TimeId){clearInterval(a.TimeId)}a.TimeId=setInterval(function(){a.DrawChart()},1000)};function ChartCurve(a,c){var b=this;SvgChart.call(b,a,c);b.MoveCount=0}ChartCurve.prototype=new SvgChart();ChartCurve.prototype.Init=function(){this.BaseInit()};ChartCurve.prototype.Dynamic=function(){this.DynamicBase()};ChartCurve.prototype.DrawChart=function(){var d=this;var c=d.PoltPaper.XAxis.Text;var e=new Date();d.PoltPaper.XAxis.UpdateTime(e);var b=false;if(d.MoveCount<c.childNodes.length){b=true;d.MoveCount++}for(var a=0;a<d.Series.length;a++){d.Series[a].Draw(d.PoltPaper,d.MoveCount,b)}};function SelectTime(b){var a=this;a.Dom=b;a.StartTime={};a.EndTime={};a.Query={}}SelectTime.prototype.Init=function(){var e=this;for(var c=0;c<e.Dom.childNodes.length;c++){var d=e.Dom.childNodes[c];if(d.classList.contains("SelectTime1")){for(var b=0;b<d.childNodes.length;b++){var a=d.childNodes[b];if(a.nodeName=="text"){e.StartTime.text=a}else{if(a.nodeName=="rect"){e.StartTime.rect=a}}}}else{if(d.classList.contains("SelectTime2")){for(var b=0;b<d.childNodes.length;b++){var a=d.childNodes[b];if(a.nodeName=="text"){e.EndTime.text=a}else{if(a.nodeName=="rect"){e.EndTime.rect=a}}}}else{if(d.classList.contains("Query")){for(var b=0;b<d.childNodes.length;b++){var a=d.childNodes[b];if(a.nodeName=="text"){e.Query.text=a}else{if(a.nodeName=="rect"){e.Query.rect=a}}}}}}}};function ChartCurveDB(a,c){var b=this;SvgChart.call(b,a,c);b.MoveCount=0;b.Time=null;b.XHR=null;b.bStop=false;b.bMsg=false;b.ReturnData=[];b.RemainData=[];b.data=[]}ChartCurveDB.prototype=new SvgChart();ChartCurveDB.prototype.Init=function(){var d=this;d.BaseInit();var c="";var a;for(var b=0;b<d.Series.length;b++){if(b==0){c=d.Series[b].Serie.AssPoint.SendHis+",";a=d.Series[b].Serie.AssPoint.Type;d.Table=a+"his"}else{if(b==d.Series.length-1){c+=d.Series[b].Serie.AssPoint.SendHis}else{c+=d.Series[b].Serie.AssPoint.SendHis+","}if(a!=d.Series[b].Serie.AssPoint.Type){d.Destroy();alert("暂时不允许关联不同类型的点！");return}}}d.StrPoints='{"'+d.Table+'":['+c+"]}";d.XMLHttpRequestInit()};ChartCurveDB.prototype.DrawChart=function(){var f=this;if(f.bStop){f.bStop=false;f.QueryDom.setAttribute("fill","black");if(f.TimeId){clearInterval(f.TimeId)}return}var e=false;var d=f.PoltPaper.XAxis.Text;if(f.MoveCount<d.childNodes.length){e=true;f.MoveCount++}if(f.bMsg){return}for(var c=0;c<f.Series.length;c++){if(f.Series[c].Value.ReturnValue.length>0){var a=f.Series[c].Value.ReturnValue.shift();if(c==0){var b=new Date(a.Time);f.PoltPaper.XAxis.UpdateTimeEx(b)}f.Series[c].UpdateValue(f,+a.Value);f.Series[c].Draw(f.PoltPaper,f.MoveCount,e)}else{f.bStop=true}}};ChartCurveDB.prototype.XMLHttpRequestInit=function(){var a=this;if(a.XHR){a.XHR=null}var b;if(window.XMLHttpRequest){b=new XMLHttpRequest()}else{if(window.ActiveXObject){b=new ActiveXObject("Microsoft.XMLHTTP")}}b.timeout=8000;a.XhrUrl="http://"+location.host+"/Api/request/_module/Hisdatalist/_action/loadMeasureResults";b.onreadystatechange=function(){if(this.readyState==4&&this.status==200){if(!this.response.data){return}a.ReturnData=this.response.data;if(a.ReturnData<1){return}if(a.RemainData.length<1){a.RemainData=a.ReturnData}else{a.RemainData.concat(a.ReturnData)}if(a.RemainData.length<1&&a.Count==1){alert("无数据记录！");return}a.data=a.RemainData;a.RemainData=[];var c=a.Series.length;var d=a.data.length;var l=d%c;for(var k=0;k<l;k++){a.RemainData[k]=a.data.pop()}if(a.data.length>0){a.bMsg=true;var f=a.Series[0].Value.ReturnValue.length;for(var k=0;k<c;k++){for(var g=0;g<Math.floor(d/c);g++){var h={};h.Value=+a.data[g*c+k].value;h.Time=a.data[g*c+k].rectime;a.Series[k].Value.ReturnValue[g+f]=h}}if(a.Count==1){a.bStop=false;a.QueryDom=a.evt.target;a.QueryDom.setAttribute("fill","red");a.FlushTime=MyConstant.getConstants("CURVEDB_FLUSHTIME");if(a.TimeId){clearInterval(a.TimeId)}a.TimeId=setInterval(function(){a.DrawChart()},a.FlushTime)}a.bMsg=false}if(a.Times.length>0){var m=a.Times.shift();var e="stime="+m.StartTime+"&etime="+m.StopTime;a.StrSend=e+a.StrOthers;this.open("POST",a.XhrUrl,true,"admin","SMmanager");this.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");this.responseType="json";this.send(a.StrSend)}a.Count++}};a.XHR=b};function Chart_OnClickQueryDB(k,h){var a=h.split(/[_]/i);var n=document.getElementById(a[0]);var e=document.getElementById(a[1]);var f=a[0].split(/[H]/i);var g=document.getElementById("Chart"+f[0]);var l=GetSvgChart(g);l.MoveCount=0;l.evt=k;for(var o=0;o<l.Series.length;o++){l.Series[o].Value.ReturnValue=[]}if(l.TimeId){clearInterval(l.TimeId)}var c=new Date(n.textContent);var d=new Date(e.textContent);var u=Math.floor((d.getTime()-c.getTime())/MyConstant.getConstants("XHR_HISDATA_TIME"));if(c.getTime()>d.getTime()){alert("查询的开始时间大于结束时间，请重新选择");return}l.Times=[];var b=n.textContent;for(var o=0;o<u+1;o++){var j={};j.StartTime=b;if(o==u){j.StopTime=e.textContent}else{j.StopTime=AddTime(b,MyConstant.getConstants("XHR_HISDATA_TIME"));b=j.StopTime}l.Times[o]=j}var q='["'+l.Table+"_"+e.textContent.substr(0,4)+"_"+e.textContent.substr(5,2)+'"]',m=l.StrPoints,t=0,s=3000;var r=l.Times.shift();var p="stime="+r.StartTime+"&etime="+r.StopTime;l.StrOthers="&tables="+q+"&points="+m+"&start="+t+"&limit="+s;l.StrSend=p+l.StrOthers;l.ReturnData=[],l.RemainData=[],l.data=[];l.Count=1;l.XHR.open("POST",l.XhrUrl,true,"admin","SMmanager");l.XHR.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");l.XHR.responseType="json";l.XHR.send(l.StrSend)}function ChartStick(a,c){var b=this;SvgChart.call(b,a,c)}ChartStick.prototype=new SvgChart();ChartStick.prototype.Init=function(){this.BaseInit()};ChartStick.prototype.Dynamic=function(){var a=this;a.DynamicBase()};ChartStick.prototype.DrawChart=function(){var b=this;for(var a=0;a<b.Series.length;a++){b.Series[a].Draw(b.PoltPaper)}};function ChartPie(a,c){var b=this;SvgChart.call(b,a,c)}ChartPie.prototype=new SvgChart();ChartPie.prototype.Init=function(){this.BaseInit()};ChartPie.prototype.Dynamic=function(){var a=this;a.DynamicBase()};ChartPie.prototype.DrawChart=function(){var u=this;var v=0;var r=+u.Series[0].Serie.Points[2].substr(1),q=+u.Series[0].Serie.Points[3],p=+u.Series[0].Serie.Points[9].substr(1),f=+u.Series[0].Serie.Points[10],e=0,s,d,h,g,k,j,o;for(var m=0;m<u.Series.length;m++){var n=u.Series[m].Value.childNodes.length;var t=+(u.Series[m].Value.DeValues[n-1].Value.toFixed(1));v+=t}for(var m=0;m<u.Series.length;m++){var l=+u.Series[m].Value.DeValues[n-1].Value;var c=l/v.toFixed(4);s=c*360;d=(e+s)*Math.PI/180;o=(e+s/2)*Math.PI/180;if(c>=0.5){u.Series[m].Serie.Points[5]=1}else{u.Series[m].Serie.Points[5]=0}if(m>0){u.Series[m].Serie.Points[0]="M"+u.Series[m-1].Serie.Points[7];u.Series[m].Serie.Points[1]=u.Series[m-1].Serie.Points[8]}h=r*q*Math.cos(d)/Math.sqrt(r*r*Math.sin(d)*Math.sin(d)+q*q*Math.cos(d)*Math.cos(d));g=r*q*Math.sin(d)/Math.sqrt(r*r*Math.sin(d)*Math.sin(d)+q*q*Math.cos(d)*Math.cos(d));if(m!=u.Series.length-1){u.Series[m].Serie.Points[7]=h+p;u.Series[m].Serie.Points[8]=g+f}u.Series[m].Serie.setAttribute("d",u.Series[m].Serie.Points);k=r*q*Math.cos(o)/Math.sqrt(r*r*Math.sin(o)*Math.sin(o)+q*q*Math.cos(o)*Math.cos(o));j=r*q*Math.sin(o)/Math.sqrt(r*r*Math.sin(o)*Math.sin(o)+q*q*Math.cos(o)*Math.cos(o));if(c>0.08){u.Series[m].Value.childNodes[0].setAttribute("x",k/2+p);u.Series[m].Value.childNodes[0].setAttribute("y",j/2+f);u.Series[m].Value.childNodes[1].setAttribute("x",k/2+p);u.Series[m].Value.childNodes[1].setAttribute("y",j/2+f+16)}else{u.Series[m].Value.childNodes[0].setAttribute("x",k+p);u.Series[m].Value.childNodes[0].setAttribute("y",j+f);u.Series[m].Value.childNodes[1].setAttribute("x",k+p);u.Series[m].Value.childNodes[1].setAttribute("y",j+f+16)}u.Series[m].Value.childNodes[0].textContent=l;u.Series[m].Value.childNodes[1].textContent=(c*100).toFixed(2)+"%";e+=s}};function Date_MouseOver(a){a.style.cursor="auto"}function Query_MouseOver(a){a.style.cursor="hand"}function Legend_MouseOver(a){a.style.cursor="auto"}function LegendSymbol_MouseOver(a){a.style.cursor="hand"}function LegendText_MouseOver(a){a.style.cursor="hand"}function LegendSymbol_Click(d,c){var a=document.getElementById(d);var b=GetSvgChart(a);if(b.Series[+c].Serie.getAttribute("display")!="none"){if(b.Series[+c].Value.getAttribute("display")=="none"){b.Series[+c].Value.setAttribute("display","true")}else{b.Series[+c].Value.setAttribute("display","none")}}}function LegendSymbol_DbClick(c,a){var b=this}function LegendText_Click(e,c){var a=document.getElementById(e);var b=GetSvgChart(a);var d=true;if(b.Series[+c].Serie.getAttribute("display")=="none"){b.Series[+c].Serie.setAttribute("display","true");if(e.substr(5,3)!="Cur"){d=false;LegendSymbol_Click(e,c)}}else{b.Series[+c].Serie.setAttribute("display","none")}if(d){b.Series[+c].Value.setAttribute("display","none")}}function LegendText_DbClick(c,a){var b=this}function Chart_OnMousemove(g,m){var q=0,x,c,b,f,u;var d=document.getElementById(m);var l=GetSvgChart(d);for(q=0;q<g_WldSvg.length;q++){if(g.target.ownerSVGElement==g_WldSvg[q].Dom){x=g_WldSvg[q];break}}if(q>=g_WldSvg.length){return}if((x.OffParentH!=x.Dom.offsetParent.offsetHeight)||(x.OffParentW!=x.Dom.offsetParent.offsetWidth)){x.OffParentH=x.Dom.offsetParent.offsetHeight;x.OffParentW=x.Dom.offsetParent.offsetWidth;x.OnSize()}if(typeof(x.Dom.attributes.transformx)!="undefined"){if(x.tx!=+x.Dom.attributes.transformx.value||x.ty!=+x.Dom.attributes.transformy.value){x.Move()}}else{x.tx=x.ty=0}if(typeof(x.Dom.attributes.scalek)!="undefined"){if(x.Scalek!=x.Dom.attributes.scalek.value){x.Scale()}}x.left=x.sumLeft-x.tx;x.top=x.sumTop-x.ty;x.Ratio=typeof(x.Ratio)!="undefined"?x.Ratio:x.Rect.Ratio;c=(g.clientX-x.left-(x.Rect.Width-x.ViewBox[2]*x.Ratio)/2)/x.Ratio;b=(g.clientY-x.top-(x.Rect.Height-x.ViewBox[3]*x.Ratio)/2)/x.Ratio;if(c>l.PoltPaper.OriginX&&c<l.PoltPaper.EndX&&b>l.PoltPaper.EndY&&b<l.PoltPaper.OriginY){if(l.Prompt.Prompt){var p=g.target.ownerDocument.getElementById(m+"Prompt").firstChild;var e=p.width.animVal.value;var r=p.height.animVal.value;f=c;u=b;if(c+e>g.target.x.animVal.value+g.target.width.animVal.value){f=c-e}if(b+r>g.target.y.animVal.value+g.target.height.animVal.value){u=b-r}l.Prompt.Prompt.setAttribute("x",f);l.Prompt.Prompt.setAttribute("y",u);l.Prompt.Prompt.setAttribute("display","true");var v=g.target.ownerDocument.getElementById(m+"Prompt");var t,s;for(var n=0;n<l.PoltPaper.XAxis.Text.childNodes.length;n++){t=l.PoltPaper.OriginX+n*l.PoltPaper.PerGridX-l.PoltPaper.PerGridX/2;s=t+l.PoltPaper.PerGridX;if(c>=t&&c<s){break}}if(n>=l.PoltPaper.XAxis.Text.length){return}var a=new Array();if(v.childNodes.length-1==l.Series.length+1){for(var o=0;o<v.childNodes.length-1;o++){a[o]=v.childNodes[o+1].textContent.split(/[:]/i)[0];if(o==v.childNodes.length-2){v.childNodes[o+1].textContent=a[o]+": "+l.PoltPaper.XAxis.Text.childNodes[n].textContent}else{v.childNodes[o+1].textContent=a[o]+": "+l.Series[o].Value.childNodes[n].textContent}}}else{for(var o=0;o<v.childNodes.length-1;o++){a[o]=v.childNodes[o+1].textContent.split(/[:]/i)[0];v.childNodes[o+1].textContent=a[o]+": "+l.Series[o].Value.childNodes[n].textContent}}if(l.Prompt.Horizontal){l.Prompt.Horizontal.setAttribute("display","true");l.Prompt.Horizontal.setAttribute("y1",b);l.Prompt.Horizontal.setAttribute("y2",b)}if(l.Prompt.Vertical){l.Prompt.Vertical.setAttribute("display","true");l.Prompt.Vertical.setAttribute("x1",c);l.Prompt.Vertical.setAttribute("x2",c)}}}else{if(l.Prompt.Prompt){l.Prompt.Prompt.setAttribute("display","none")}if(l.Prompt.Horizontal){l.Prompt.Horizontal.setAttribute("display","none")}if(l.Prompt.Vertical){l.Prompt.Vertical.setAttribute("display","none")}}}function Rect_Click(b){var a=MyConstant.getConstants("CURVEDB_FLUSHTIME");FlushSpeed(b,a)}function Rect_DbClick(b){var a=MyConstant.getConstants("CURVEDB_FLUSHTIME")/2;FlushSpeed(b,a)}function FlushSpeed(d,c){var a=document.getElementById(d);var b=GetSvgChart(a);if(b.FlushTime==c){return}b.FlushTime=c;if(b.TimeId){clearInterval(b.TimeId);b.TimeId=setInterval(function(){b.DrawChart()},b.FlushTime)}}function Graph_MouseOver(b){var a=b.getAttribute("contrlmap")||b.getAttribute("contrlMap");if(a){var d=a.replace(/'/g,'"');var c=JSON.parse(d);SetStyle(b,c.MouseOverColor.FillColor)}}function Graph_MouseOut(b){if(b.classList.contains("svgtext")){for(var a=0;a<b.childNodes.length;a++){b.childNodes[a].setAttribute("mover",0)}}else{b.setAttribute("mover",0)}}function SetStyle(c,a){if(c.classList.contains("svgtext")){for(var b=0;b<c.childNodes.length;b++){c.childNodes[b].setAttribute("mover",1)}}else{c.setAttribute("mover",1)}}window.onresize=OnResize;function OnResize(){for(var a=0;a<g_WldSvg.length;a++){g_WldSvg[a].SvgResize()}}function GetIdStr(a){var b;if(a==1){b="Fir"}else{if(a==2){b="Sec"}else{if(a==3){b="Thi"}else{if(a==4){b="Fou"}}}}return b}function CheckTime(a){if(a<10){a="0"+a}return a}function GetSvg(a){for(i=0;i<g_WldSvg.length;i++){if(g_WldSvg[i].Dom==a){return g_WldSvg[i]}}}function GetSvgGraph(b){for(i=0;i<g_WldSvg.length;i++){if(g_WldSvg[i].Dom==b.ownerSVGElement){for(var a=0;a<g_WldSvg[i].Graphs.length;a++){if(b.id==g_WldSvg[i].Graphs[a].GraphID){return g_WldSvg[i].Graphs[a]}}}}}function GetSvgChart(b){for(i=0;i<g_WldSvg.length;i++){if(g_WldSvg[i].Dom==b.ownerSVGElement){for(var a=0;a<g_WldSvg[i].Charts.length;a++){if(b.id==g_WldSvg[i].Charts[a].ChartID){return g_WldSvg[i].Charts[a]}}}}}function AddTime(a,e){var c=Date.parse(a)+e;var b=new Date(c);return b.getFullYear()+"-"+CheckTime(+b.getMonth()+1)+"-"+CheckTime(b.getDate())+" "+CheckTime(b.getHours())+":"+CheckTime(b.getMinutes())+":"+CheckTime(b.getSeconds())}function smooth(p,r){var p=p,d=[p[0]],g=p[0][1],f=p[0][2],s,t,v=1,h=p.length,e=1,l=g,k=f,A,z,w,n,u,o,c,b;for(;v<h;v++){A=p[v];z=A.length;w=p[v-1];n=w.length;u=p[v+1];o=u&&u.length;if(A[0]=="M"){l=A[1];k=A[2];s=v+1;while(p[s][0]!="C"){s++}d.push(["M",l,k]);e=d.length;g=l;f=k;continue}if(A[z-2]==l&&A[z-1]==k&&(!u||u[0]=="M")){c=d[e].length;t=getAnchors(w[n-2],w[n-1],l,k,d[e][c-2],d[e][c-1],r);d[e][1]=t.x2;d[e][2]=t.y2}else{if(!u||u[0]=="M"){t={x1:A[z-2],y1:A[z-1]}}else{t=getAnchors(w[n-2],w[n-1],A[z-2],A[z-1],u[o-2],u[o-1],r)}}d.push(["C",g,f,t.x1,t.y1,A[z-2],A[z-1]]);g=t.x2;f=t.y2}var a=d;for(var q=0;q<a.length;q++){a[q]=d[q].join(" ")}b=a.join(",");return b}function getAnchors(e,d,k,j,v,u,q){q=q||4;var h=Math,p=h.PI,r=p/2,m=h.abs,a=h.sin,b=h.cos,f=h.atan,t,s,g,l,o,n,x,w,c;t=Math.abs(k-e)/q;s=Math.abs(v-k)/q;if((j>=d&&j>=u)||(j<=d&&j<=u)){g=l=r}else{g=f(Math.abs(k-e)/m(j-d));if(d<j){g=p-g}l=f(Math.abs(v-k)/m(j-u));if(u<j){l=p-l}}c=r-((g+l)%(p*2))/2;if(c>r){c-=p}g+=c;l+=c;k=+k;j=+j;if(k>e){o=k-t*a(g);n=j+(t*b(g));x=k+s*a(l);w=j+s*b(l)}else{o=k+t*a(g);n=j+(t*b(g));x=k-s*a(l);w=j+s*b(l)}if((j>d&&n<d)||(j<d&&n>d)){o+=m(d-n)*(o-k)/(n-j);n=+d}if((j>u&&w<u)||(j<u&&w>u)){x-=m(u-w)*(x-k)/(w-j);w=+u}o=+o.toFixed(1);n=+n.toFixed(1);x=+x.toFixed(1);w=+w.toFixed(1);return{x1:o,y1:n,x2:x,y2:w}}function GetTestDigital(){return Math.random()>0.5?1:0}function GetTestAnalog(){return Math.random()*1000}function DealWithText(b){var c={};for(var a=0;a<b.childNodes.length;a++){if(b.childNodes[a].nodeName=="text"){c.text=b.childNodes[a]}else{if(b.childNodes[a].nodeName=="rect"){c.rect=b.childNodes[a]}else{if(b.childNodes[a].nodeName=="title"){c.title=b.childNodes[a]}}}}return c}function DealWithPolar(a,b){if(a==2){if(b==1){b=0}else{b=1}}return b}function DealWithLimitStatus(a,c){var b;if(a==1){b=c.DX}else{if(a==2){b=c.GX}else{if(a==3){b=c.DDX}else{if(a==4){b=c.GGX}else{b=c.Normal}}}}return b}function DealWithOnOff(c,b){var a;if(c==1){a=b.On}else{a=b.Off}return a}function DealWithFrequency(b){var a=0;if(+b.Fre==0){a=600}else{if(+b.Fre==1){a=400}else{a=200}}return a}function L_calendar(){}L_calendar.prototype={Moveable:true,NewName:"",insertId:"",ClickObject:null,InputObject:null,InputDate:null,IsOpen:false,MouseX:0,MouseY:0,GetDateLayer:function(){var a=document.getElementById("L_DateLayer").contentWindow;return a},L_TheYear:new Date().getFullYear(),L_TheMonth:new Date().getMonth()+1,L_WDay:new Array(39),MonHead:new Array(31,28,31,30,31,30,31,31,30,31,30,31),L_TheHour:new Date().getHours(),L_TheMin:new Date().getMinutes,L_TheSec:new Date().getSeconds,GetY:function(){var a;if(arguments.length>0){a==arguments[0]}else{a=this.ClickObject}if(a!=null){return event.clientY+12}else{return 0}},GetX:function(){var a;if(arguments.length>0){a==arguments[0]}else{a=this.ClickObject}if(a!=null){return event.clientX-40}else{return 0}},CreateHTML:function(){var b="";b+='<div id="L_calendar">\r\n';b+='<span id="SelectYearLayer" style="z-index: 19999;position: absolute;top: 3; left: 19;display: none"></span>\r\n';b+='<span id="SelectMonthLayer" style="z-index: 19999;position: absolute;top: 3; left: 78;display: none"></span>\r\n';b+='<span id="SelectHourLayer" style="z-index: 19999;position: absolute;top: 24; left: 0;display: none"></span>\r\n';b+='<span id="SelectMinLayer" style="z-index: 19999;position: absolute;top: 24; left: 50;display: none"></span>\r\n';b+='<span id="SelectSecLayer" style="z-index: 19999;position: absolute;top: 24; left: 100;display: none"></span>\r\n';b+='<div id="L_calendar-year-month"><div id="L_calendar-PrevM" onclick="parent.'+this.NewName+'.PrevM()" title="前一月"><b><</b></div><div id="L_calendar-year" onmouseover="style.backgroundColor=\'#FFD700\'" onmouseout="style.backgroundColor=\'white\'" onclick="parent.'+this.NewName+".SelectYearInnerHTML('"+this.L_TheYear+'\')"></div><div id="L_calendar-month"  onmouseover="style.backgroundColor=\'#FFD700\'" onmouseout="style.backgroundColor=\'white\'" onclick="parent.'+this.NewName+".SelectMonthInnerHTML('"+this.L_TheMonth+'\')"></div><div id="L_calendar-NextM" onclick="parent.'+this.NewName+'.NextM()" title="后一月"><b>></b></div></div>\r\n';b+='<div id="L_calendar-hour-min-sec"><div id="L_calendar-hour" onmouseover="style.backgroundColor=\'#FFD700\'" onmouseout="style.backgroundColor=\'white\'" onclick="parent.'+this.NewName+".SelectHourInnerHTML('"+this.L_TheHour+'\')"></div><div id="L_calendar-min"  onmouseover="style.backgroundColor=\'#FFD700\'" onmouseout="style.backgroundColor=\'white\'" onclick="parent.'+this.NewName+".SelectMinInnerHTML('"+this.L_TheMin+'\')"></div><div id="L_calendar-sec"  onmouseover="style.backgroundColor=\'#FFD700\'" onmouseout="style.backgroundColor=\'white\'" onclick="parent.'+this.NewName+".SelectSecInnerHTML('"+this.L_TheSec+"')\"></div></div>\r\n";b+='<div id="L_calendar-week"><ul  onmouseup="StopMove()"><li>日</li><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li>六</li></ul></div>\r\n';b+='<div id="L_calendar-day">\r\n';b+="<ul>\r\n";for(var c=0;c<this.L_WDay.length;c++){b+='<li id="L_calendar-day_'+c+'" style="background:#e0e0e0" onmouseover="this.style.background=\'#FFD700\'"  onmouseout="this.style.background=\'#e0e0e0\'"></li>\r\n'}b+="</ul>\r\n";b+='<span id="L_calendar-today" onclick="parent.'+this.NewName+'.Today()"><b>Today</b></span>\r\n';b+="</div>\r\n";b+="</div>\r\n";b+='<script type="text/javascript">\r\n';b+="var MouseX,MouseY;";b+="var Moveable="+this.Moveable+";\r\n";b+="var MoveaStart=false;\r\n";b+="document.onmousemove=function(e)\r\n";b+="{\r\n";b+='var DateLayer=parent.document.getElementById("L_DateLayer");\r\n';b+="  e = window.event || e;\r\n";b+='var DateLayerLeft=DateLayer.style.posLeft || parseInt(DateLayer.style.left.replace("px",""));\r\n';b+='var DateLayerTop=DateLayer.style.posTop || parseInt(DateLayer.style.top.replace("px",""));\r\n';b+='if(MoveaStart){DateLayer.style.left=(DateLayerLeft+e.clientX-MouseX)+"px";DateLayer.style.top=(DateLayerTop+e.clientY-MouseY)+"px"}\r\n';b+=";\r\n";b+="}\r\n";b+='document.getElementById("L_calendar-week").onmousedown=function(e){\r\n';b+="if(Moveable){MoveaStart=true;}\r\n";b+="  e = window.event || e;\r\n";b+="  MouseX = e.clientX;\r\n";b+="  MouseY = e.clientY;\r\n";b+="  }\r\n";b+="function StopMove(){\r\n";b+="MoveaStart=false;\r\n";b+="  }\r\n";b+="<\/script>\r\n";var a="";a+='<style type="text/css">';a+="body{background:#fff;font-size:12px;margin:0px;padding:0px;text-align:left}\r\n";a+="#L_calendar{border:1px solid blue;width:160px;padding:1px;height:200px;z-index:19998;text-align:center}\r\n";a+="#L_calendar-year-month{height:23px;line-height:23px;z-index:19998;}\r\n";a+="#L_calendar-year{line-height:23px;width:60px;float:left;z-index:19998;position: absolute;top: 3; left: 19;cursor:default}\r\n";a+="#L_calendar-month{line-height:23px;width:48px;float:left;z-index:19998;position: absolute;top: 3; left: 78;cursor:default}\r\n";a+="#L_calendar-PrevM{position: absolute;top: 3; left: 5;cursor:pointer}";a+="#L_calendar-NextM{position: absolute;top: 3; left: 145;cursor:pointer}";a+="#L_calendar-hour-min-sec{height:23px;line-height:23px;z-index:19998;}\r\n";a+="#L_calendar-hour{line-height:23px;width:48px;float:left;z-index:19998;position: absolute;top: 24; left: 5;cursor:default}\r\n";a+="#L_calendar-min{line-height:23px;width:48px;float:left;z-index:19998;position: absolute;top: 24; left: 55;cursor:default}\r\n";a+="#L_calendar-sec{line-height:23px;width:48px;float:left;z-index:19998;position: absolute;top: 24; left: 105;cursor:default}\r\n";a+="#L_calendar-week{height:23px;line-height:23px;z-index:19998;}\r\n";a+="#L_calendar-day{height:136px;z-index:19998;}\r\n";a+="#L_calendar-week ul{cursor:move;list-style:none;margin:0px;padding:0px;}\r\n";a+="#L_calendar-week li{width:20px;height:20px;float:left;;margin:1px;padding:0px;text-align:center;}\r\n";a+="#L_calendar-day ul{list-style:none;margin:0px;padding:0px;}\r\n";a+="#L_calendar-day li{cursor:pointer;width:20px;height:20px;float:left;;margin:1px;padding:0px;}\r\n";a+="#L_calendar-today{cursor:pointer;float:left;width:63px;height:20px;line-height:20px;margin:1px;text-align:center;background:red}";a+="</style>";var e="<html>\r\n";e+="<head>\r\n";e+="<title></title>\r\n";e+=a;e+="</head>\r\n";e+="<body>\r\n";e+=b;e+="</body>\r\n";e+="</html>\r\n";var f=document.getElementById("L_DateLayer").contentWindow.document;var d=e;f.designMode="on";f.open();f.write(d);f.close();f.designMode="off"},InsertHTML:function(d,b){var a=this.GetDateLayer();if(a){a.document.getElementById(d).innerHTML=b}var c=a.document.getElementById(d).innerHTML},WriteHead:function(e,c,b,d,a){this.InsertHTML("L_calendar-year",e+" 年");this.InsertHTML("L_calendar-month",c+" 月");this.InsertHTML("L_calendar-hour",b+" 时");this.InsertHTML("L_calendar-min",d+" 分");this.InsertHTML("L_calendar-sec",a+" 秒")},IsPinYear:function(a){if(0==a%4&&((a%100!=0)||(a%400==0))){return true}else{return false}},GetMonthCount:function(a,b){var d=this.MonHead[b-1];if((b==2)&&this.IsPinYear(a)){d++}return d},GetDOW:function(a,d,b){var c=new Date(b,d-1,a).getDay()/7;return c},GetText:function(a){if(a.innerText){return a.innerText}else{return a.textContent}},PrevM:function(){if(this.L_TheMonth>1){this.L_TheMonth--}else{this.L_TheYear--;this.L_TheMonth=12}this.SetDay(this.L_TheYear,this.L_TheMonth,this.L_TheHour,this.L_TheMin,this.L_TheSec)},NextM:function(){if(this.L_TheMonth==12){this.L_TheYear++;this.L_TheMonth=1}else{this.L_TheMonth++}this.SetDay(this.L_TheYear,this.L_TheMonth,this.L_TheHour,this.L_TheMin,this.L_TheSec)},Today:function(){var a;this.L_TheYear=new Date().getFullYear();this.L_TheMonth=new Date().getMonth()+1;a=new Date();if(this.InputObject){this.InputObject.textContent=CheckTime(this.L_TheYear)+"-"+CheckTime(this.L_TheMonth)+"-"+CheckTime(a.getDate())+" "+CheckTime(a.getHours())+":"+CheckTime(a.getMinutes())+":"+CheckTime(a.getSeconds())}this.CloseLayer()},SetDay:function(l,d,p,q,h){l=+l;d=+d;if(isNaN(p)){p=0}if(isNaN(q)){q=0}if(isNaN(h)){h=0}p=+p;q=+q;h=+h;this.WriteHead(l,d,p,q,h);this.L_TheYear=l;this.L_TheMonth=d;this.L_TheHour=p;this.L_TheMin=q;this.L_TheSec=h;if(window.top.location.href!=window.location.href){for(var e=0;e<window.top.frames.length;e++){if(window.top.frames[e].location.href==window.location.href){L_DateLayer_Parent=window.top.frames[e]}}}else{L_DateLayer_Parent=window.parent}for(var g=0;g<39;g++){this.L_WDay[g]=""}var o=1,n=1,a=new Date(l,d-1,1).getDay();for(g=0;g<a;g++){this.L_WDay[g]=this.GetMonthCount(d==1?l-1:l,d==1?12:d-1)-a+g+1}for(g=a;o<this.GetMonthCount(l,d)+1;g++){this.L_WDay[g]=o;o++}for(g=a+this.GetMonthCount(l,d);g<39;g++){this.L_WDay[g]=n;n++}for(g=0;g<39;g++){var b=false;var r=this.GetDateLayer().document.getElementById("L_calendar-day_"+g+"");var k,m,c,f,j;if(this.L_WDay[g]!=""){if(g<a){r.innerHTML='<b style="color:gray">'+this.L_WDay[g]+"</b>";k=d;m=this.L_WDay[g];c=p;f=q;j=h}else{if(g>=a+this.GetMonthCount(l,d)){r.innerHTML='<b style="color:gray">'+this.L_WDay[g]+"</b>";k=d;m=this.L_WDay[g];c=p;f=q;j=h}else{b=true;r.innerHTML='<b style="color:#000">'+this.L_WDay[g]+"</b>";k=d;m=this.L_WDay[g];c=p;f=q;j=h;if(document.all){r.onclick=Function("L_DateLayer_Parent."+this.NewName+".DayClick("+k+","+m+","+c+","+f+","+j+")")}else{r.setAttribute("onclick","parent."+this.NewName+".DayClick("+k+","+m+","+c+","+f+","+j+")")}}}r.title=k+" 月"+m+" 日";r.style.background=(l==new Date().getUTCFullYear()&&k==new Date().getUTCMonth()+1&&m==new Date().getUTCDate())?"#FFD700":"#e0e0e0";if(this.InputDate!=null&&b){if(l==this.InputDate.getUTCFullYear()&&k==this.InputDate.getUTCMonth()+1&&m==this.InputDate.getUTCDate()){r.style.background="#0650D2"}}}}},SelectYearInnerHTML:function(f){if(f.match(/\D/)!=null){alert("年份输入参数不是数字！");return}var a=(f)?f:new Date().getFullYear();if(a<1000||a>9999){alert("年份值不在 1000 到 9999 之间！");return}var g=a-10;if(g<1000){g=1000}if(g+26>9999){g=9974}var e='<select name="L_SelectYear" id="L_SelectYear" style=\'font-size: 12px\' ';e+='onblur=\'document.getElementById("SelectYearLayer").style.display="none"\' ';e+='onchange=\'document.getElementById("SelectYearLayer").style.display="none";';e+="parent."+this.NewName+".L_TheYear = this.value; parent."+this.NewName+".SetDay(parent."+this.NewName+".L_TheYear,parent."+this.NewName+".L_TheMonth,parent."+this.NewName+".L_TheHour,parent."+this.NewName+".L_TheMin,parent."+this.NewName+".L_TheSec)'>\r\n";var d=e;for(var c=g;c<g+26;c++){if(c==a){d+="<option value='"+c+"' selected>"+c+" 年</option>\r\n"}else{d+="<option value='"+c+"'>"+c+" 年</option>\r\n"}}d+="</select>";var b=this.GetDateLayer();b.document.getElementById("SelectYearLayer").style.display="";b.document.getElementById("SelectYearLayer").innerHTML=d;b.document.getElementById("L_SelectYear").focus()},SelectMonthInnerHTML:function(f){if(f.match(/\D/)!=null){alert("月份输入参数不是数字！");return}var a=(f)?f:new Date().getMonth()+1;var e='<select name="L_SelectYear" id="L_SelectMonth" style=\'font-size: 12px\' ';e+='onblur=\'document.getElementById("SelectMonthLayer").style.display="none"\' ';e+='onchange=\'document.getElementById("SelectMonthLayer").style.display="none";';e+="parent."+this.NewName+".L_TheMonth = this.value; parent."+this.NewName+".SetDay(parent."+this.NewName+".L_TheYear,parent."+this.NewName+".L_TheMonth,parent."+this.NewName+".L_TheHour,parent."+this.NewName+".L_TheMin,parent."+this.NewName+".L_TheSec)'>\r\n";var d=e;for(var c=1;c<13;c++){if(c==a){d+="<option value='"+c+"' selected>"+c+" 月</option>\r\n"}else{d+="<option value='"+c+"'>"+c+" 月</option>\r\n"}}d+="</select>";var b=this.GetDateLayer();b.document.getElementById("SelectMonthLayer").style.display="";b.document.getElementById("SelectMonthLayer").innerHTML=d;b.document.getElementById("L_SelectMonth").focus()},SelectHourInnerHTML:function(b){if(b.match(/\D/)!=null){alert("输入参数不是数字！");return}var f=(b)?b:new Date().getHours();var e='<select name="L_SelectHour" id="L_SelectHour" style=\'font-size: 12px\' ';e+='onblur=\'document.getElementById("SelectHourLayer").style.display="none"\' ';e+='onchange=\'document.getElementById("SelectHourLayer").style.display="none";';e+="parent."+this.NewName+".L_TheHour = this.value; parent."+this.NewName+".SetDay(parent."+this.NewName+".L_TheYear,parent."+this.NewName+".L_TheMonth,parent."+this.NewName+".L_TheHour,parent."+this.NewName+".L_TheMin,parent."+this.NewName+".L_TheSec)'>\r\n";var d=e;for(var c=0;c<24;c++){if(c==f){d+="<option value='"+c+"' selected>"+c+" 时</option>\r\n"}else{d+="<option value='"+c+"'>"+c+" 时</option>\r\n"}}d+="</select>";var a=this.GetDateLayer();a.document.getElementById("SelectHourLayer").style.display="";a.document.getElementById("SelectHourLayer").innerHTML=d;a.document.getElementById("L_SelectHour").focus()},SelectMinInnerHTML:function(f){if(f.match(/\D/)!=null){alert("输入参数不是数字！");return}var c=(f)?f:new Date().getMinutes();var e='<select name="L_SelectHour" id="L_SelectMin" style=\'font-size: 12px\' ';e+='onblur=\'document.getElementById("SelectMinLayer").style.display="none"\' ';e+='onchange=\'document.getElementById("SelectMinLayer").style.display="none";';e+="parent."+this.NewName+".L_TheMin = this.value; parent."+this.NewName+".SetDay(parent."+this.NewName+".L_TheYear,parent."+this.NewName+".L_TheMonth,parent."+this.NewName+".L_TheHour,parent."+this.NewName+".L_TheMin,parent."+this.NewName+".L_TheSec)'>\r\n";var d=e;for(var b=0;b<60;b++){if(b==c){d+="<option value='"+b+"' selected>"+b+" 分</option>\r\n"}else{d+="<option value='"+b+"'>"+b+" 分</option>\r\n"}}d+="</select>";var a=this.GetDateLayer();a.document.getElementById("SelectMinLayer").style.display="";a.document.getElementById("SelectMinLayer").innerHTML=d;a.document.getElementById("L_SelectMin").focus()},SelectSecInnerHTML:function(a){if(a.match(/\D/)!=null){alert("输入参数不是数字！");return}var f=(a)?a:new Date().getMinutes();var e='<select name="L_SelectHour" id="L_SelectSec" style=\'font-size: 12px\' ';e+='onblur=\'document.getElementById("SelectSecLayer").style.display="none"\' ';e+='onchange=\'document.getElementById("SelectSecLayer").style.display="none";';e+="parent."+this.NewName+".L_TheSec = this.value; parent."+this.NewName+".SetDay(parent."+this.NewName+".L_TheYear,parent."+this.NewName+".L_TheMonth,parent."+this.NewName+".L_TheHour,parent."+this.NewName+".L_TheMin,parent."+this.NewName+".L_TheSec)'>\r\n";var d=e;for(var c=0;c<60;c++){if(c==f){d+="<option value='"+c+"' selected>"+c+" 秒</option>\r\n"}else{d+="<option value='"+c+"'>"+c+" 秒</option>\r\n"}}d+="</select>";var b=this.GetDateLayer();b.document.getElementById("SelectSecLayer").style.display="";b.document.getElementById("SelectSecLayer").innerHTML=d;b.document.getElementById("L_SelectSec").focus()},DayClick:function(e,a,b,c,d){var f=this.L_TheYear;if(e<1){f--;e=12+e}else{if(e>12){f++;e=e-12}}if(this.ClickObject){if(!a){return}this.InputObject.textContent=f+"-"+CheckTime(e)+"-"+CheckTime(a)+" "+CheckTime(b)+":"+CheckTime(c)+":"+CheckTime(d);this.CloseLayer()}else{this.CloseLayer();alert("您所要输出的控件对象并不存在！")}},SetDate:function(){if(arguments.length<1){alert("对不起！传入参数太少！");return}else{if(arguments.length>2){alert("对不起！传入参数太多！");return}}this.InputObject=((arguments.length==1)?arguments[0]:arguments[1]).childNodes[1];this.ClickObject=arguments[0];var f=/^(\d+)-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})$/;var a=this.InputObject.textContent.match(f);if(a!=null){var h=a[1]+"/"+a[2]+"/"+a[3]+" "+a[4]+":"+a[5]+":"+a[6];var k=new Date(h);if(k.getFullYear()==+a[1]&&k.getMonth()==a[2]-1&&k.getDate()==+a[3]){this.InputDate=k}else{this.InputDate=""}this.L_TheYear=a[1];this.L_TheMonth=a[2];this.L_TheHour=a[4];this.L_TheMin=a[5];this.L_TheSec=a[6]}else{this.L_TheYear=new Date().getFullYear();this.L_TheMonth=new Date().getMonth()+1;this.L_TheHour=new Date().getHours();this.L_TheMin=new Date().getMinutes;this.L_TheSec=new Date().getSeconds}this.CreateHTML();var l=this.GetY();var g=this.GetX();var c=document.getElementById("L_DateLayer");var e=c.style.top;c.style.top=l+"px";c.style.left=g+"px";c.style.display="block";var b=c.style.top;if(document.all){this.GetDateLayer().document.getElementById("L_calendar").style.width="160px";this.GetDateLayer().document.getElementById("L_calendar").style.height="200px"}else{var j=this.GetDateLayer().document.getElementById("L_calendar");this.GetDateLayer().document.getElementById("L_calendar").style.width="156px";this.GetDateLayer().document.getElementById("L_calendar").style.height="195px";c.style.width="160px";c.style.height="210px"}this.SetDay(this.L_TheYear,this.L_TheMonth,this.L_TheHour,this.L_TheMin,this.L_TheSec)},CloseLayer:function(){try{var a=document.getElementById("L_DateLayer");if((a.style.display==""||a.style.display=="block")&&arguments[0]!=this.ClickObject&&arguments[0]!=this.InputObject){a.style.display="none"}}catch(b){}}};var L_DateLayer_Parent=null;var iframe=document.createElement("iframe");iframe.id="L_DateLayer";iframe.name="L_DateLayer";iframe.setAttribute("frameborder","0");var str="display:none;position:absolute;width:160px;height:200px;z-index:19998;";iframe.setAttribute("style",str);var MyCalendar=new L_calendar();MyCalendar.NewName="MyCalendar";document.onclick=function(b){b=window.event||b;var a=b.srcElement||b.target;MyCalendar.CloseLayer(a)};function Chart_OnDateClick(a,b){MyCalendar.SetDate(a.target,b)};